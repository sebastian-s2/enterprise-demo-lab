---
# Testing CV pathfinder  edge with no policy in VRF default to make sure the correct
# default policy is auto generated by AVD
wan_mode: cv-pathfinder
# Disabling underlay for tests
underlay_routing_protocol: none

bgp_as: 65000

flow_tracking_settings:
  trackers:
    - name: custom_flow_track_name
      record_export:
        on_inactive_timeout: 50000
        on_interval: 300331
      exporters:
        - name: ayush_exporter
          collector:
            host: 127.0.0.1
          local_interface: Loopback0
          template_interval: 40000

fabric_flow_tracking:
  dps_interfaces:
    name: custom_flow_track_name

cv_pathfinder_regions:
  - name: AVD_Land_West
    id: 42
    description: AVD Region
    sites:
      - name: Site1
        id: 1
        location: one place

bgp_peer_groups:
  wan_overlay_peers:
    password: "htm4AZe9mIQOO1uiMuGgYQ=="
    # Overwriting TTL
    ttl_maximum_hops: 42
    listen_range_prefixes:
      - 192.168.255.0/24

wan_route_servers:
  - hostname: cv-pathfinder-pathfinder

wan_ipsec_profiles:
  control_plane:
    shared_key: ABCDEF1234567890
  data_plane:
    shared_key: ABCDEF1234567890666

default_node_types:
  - node_type: wan_router
    match_hostnames:
      - "cv-pathfinder-edge.*"

wan_router:
  defaults:
    loopback_ipv4_pool: 192.168.42.0/24
    vtep_loopback_ipv4_pool: 192.168.255.0/24
    filter:
      always_include_vrfs_in_tenants: [TenantA]
      deny_vrfs: [IT]
  nodes:
    - name: cv-pathfinder-edge-custom-default-policy
      cv_pathfinder_region: AVD_Land_West
      cv_pathfinder_site: Site1
      id: 1
      l3_interfaces:
        - name: Ethernet1
          wan_carrier: ATT
          wan_circuit_id: 666
          dhcp_accept_default_route: true
          ip_address: dhcp
        - name: Ethernet2
          wan_carrier: Colt
          wan_circuit_id: 10555
          ip_address: 172.15.5.5/31
        - name: Ethernet3
          wan_carrier: Comcast-5G
          wan_circuit_id: AF830
          ip_address: 172.20.20.20/31
          connected_to_pathfinder: False

wan_path_groups:
  - name: MPLS
    ipsec:
      static_peers: false
    # TODO remove one once auto-id is implemented - for now required in schema
    id: 100
  - name: INET
    id: 101
  - name: LTE
    id: 102
  - name: Equinix
    id: 103
  - name: Satellite
    id: 104

wan_carriers:
  - name: Comcast
    path_group: INET
    trusted: true
  - name: ATT
    path_group: INET
    trusted: true
  - name: Bouygues_Telecom
    path_group: INET
    trusted: true
  - name: SFR
    path_group: INET
    trusted: true
  - name: Orange
    path_group: INET
    trusted: true
  - name: Another-ISP
    path_group: INET
    trusted: true
  - name: Colt
    path_group: MPLS
    trusted: true
  - name: ATT-MPLS
    path_group: MPLS
    trusted: true
  - name: Comcast-5G
    path_group: LTE
    trusted: true
  - name: Inmrasat
    path_group: Satellite
    trusted: true

tenants:
  - name: TenantA
    vrfs:
      - name: default
        vrf_id: 1
      - name: PROD
        vrf_id: 42
      - name: IT
        vrf_id: 100

wan_virtual_topologies:
  vrfs:
    # No policy for default or PROD, going to use DEFAULT-POLICY
    # overwrite DEFAULT-POLICY below
    - name: default
      wan_vni: 1
    - name: PROD
      wan_vni: 42
  policies:
    # Name of the DEFAULT-POLICY being overwritten
    - name: DEFAULT-POLICY
      default_virtual_topology:
        path_groups:
          - names: [INET]
          - names: [LTE]
            preference: 42
      application_virtual_topologies:
        - application_profile: VIDEO
          path_groups:
            - names: [MPLS, INET]
              preference: preferred
          id: 3

application_classification:
  application_profiles:
    - name: VIDEO
      # Testing categories filtering
      applications:
        # Testing applications in application-profiles filtering
        - name: CUSTOM-APPLICATION-1
        # Builtin application that should not raise
        - name: skype
